<div id="content">
	<hr>
	<h3>Create a new issue <span class="badge badge-warning">WIP</span></h3>
	<section class="mt-3 mb5">
	<p>Demonstrate different controls working together for a more complex workflow.</p>

	<div class="d-none" id="error-message"></div>

	<form id="issue" treetop>
		<div class="form-group row">
			<label for="inputTitle" class="col-sm-2 col-form-label">Summary</label>
			<div class="col-sm-10">
				<input autofocus="autofocus" required type="text" name="summary" class="form-control" id="inputTitle" placeholder="Title for you issue" value="{{ .Summary }}">
			</div>
		</div>
		<div class="form-group row">
			<label for="departmentSelect" class="col-sm-2 col-form-label">Department</label>
			<div class="col-sm-10">
				<select class="form-control" id="departmentSelect" name="department" onchange="document.getElementById('update-department').click()" required="required">
					<option disabled value=""{{ if eq .Dept "" }} selected{{ end }}>-- choose one --</option>
					<option value="helpdesk"{{ if eq .Dept "helpdesk" }} selected{{ end }}>Helpdesk</option>
					<option value="software"{{ if eq .Dept "software" }} selected{{ end }}>Software Development</option>
					<option value="systems"{{ if eq .Dept "systems" }} selected{{ end }}>Systems & IT</option>
				</select>
				{{/* submit button will update form when department is changed */}}
				<button class="d-none" id="update-department" treetop-submitter formnovalidate formaction="/ticket/get-form"></button>
			</div>
		</div>

		{{ block "form" .Form}}
		<div id="form" class="my-4 alert alert-light text-center">
			<h5 class="alert-heading">Please Select a Department</h5>
			<p class="mb-0">Choosing a department will show the form specific to that department.</p>
		</div>

		{{ end }}

	</form>
	</section>
</div>

{{ define "treetop-config" }}
<script>
		// activate treetop with custom form control attributes
		window.TREETOP_CONFIG = {
			mountAttr: {
				// autofocus attribute component will cause an input element
				// to be focused and have the cursor placed at the end of the input.
				"autofocus": (emt) => {
					emt.focus()
					// move cursor to the end of the input.
					// Note, this is buggy but non-essential
					setTimeout(function(){
						if (emt.type != "email") {
							emt.selectionStart = emt.selectionEnd = 10000;
						} else {
							emt.select()
						}
					}, 0);
				},
				// specify the form submitter button for an text input ENTER submit
				'enter-submitter': function (el) {
					// Use the attribute value to find the submitter element
					// if none is found, throw an error and do not register the listener
					var submitButtonID = el.getAttribute("enter-submitter")
					var submitButton = document.getElementById(submitButtonID)
					if (!submitButton) {
						throw Error("enter-submitter: No submitter element found for #"+submitButtonID)
					}
					function onKeyDown(e) {
						if (e.key == "Enter") {
							e.preventDefault()
							submitButton.click()
						}
					}
					el.addEventListener('keydown', onKeyDown, false);
				}
			}
		};
</script>
{{ end }}